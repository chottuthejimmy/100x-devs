<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Simple TODO</title>
    <style>
      #ordered-el {
        display: inline-block;
        flex-direction: column;
        text-align: start;
      }
      #ordered-el li {
        margin-bottom: 15px;
      }
    </style>
  </head>

  <body>
    <div>
      <h1 style="text-align: center">Todo list</h1>
      <div style="text-align: center">
        <input type="text" id="input-el" style="margin-bottom: 20px" autofocus/>
        <button onclick="addToDo2()">Add Todo</button>
      </div>
      <div style="text-align: center;">
        <ol id="ordered-el"></ol>
      </div>
    </div>
  </body>
  <script>
  let nextId = 1;
  const inputEl = document.getElementById("input-el");
  const orderEl = document.getElementById("ordered-el");

  function getTodos() {
    try {
      return JSON.parse(localStorage.getItem("todos") || "[]");
    } catch (_) {
      return [];
    }
  }

  function setTodos(todos) {
    localStorage.setItem("todos", JSON.stringify(todos));
  }

  function computeNextId(todos) {
    if (!todos.length) return 1;
    return Math.max(...todos.map(t => t.id)) + 1;
  }

  function renderTodos() {
    const todos = getTodos();
    orderEl.innerHTML = todos
      .map(t => (
        `<li id="${t.id}"><div>${escapeHtml(t.text)} ` +
        `<button style="margin-left: 10px" onclick="deleteToDo(${t.id})">Delete</button> ` +
        `<button style="margin-left: 10px" onclick="startEdit(${t.id})">Edit</button>` +
        `</div></li>`
      ))
      .join("");
    nextId = computeNextId(todos);
  }

  function escapeHtml(str) {
    return str
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/\"/g, "&quot;")
      .replace(/'/g, "&#039;");
  }

  function addToDo2() {
    const text = inputEl.value.trim();
    if (!text) return;
    const todos = getTodos();
    todos.push({ id: nextId, text });
    setTodos(todos);
    inputEl.value = "";
    nextId++;
    renderTodos();
  }

  function deleteToDo(id) {
    const todos = getTodos().filter(t => t.id !== id);
    setTodos(todos);
    renderTodos();
  }

  function startEdit(id) {
    const el = document.getElementById(id);
    const todos = getTodos();
    const t = todos.find(x => x.id === id);
    if (!t) return;
    el.firstChild.innerHTML =
      `<input type="text" value="${escapeHtml(t.text)}" id="input-${id}"/> ` +
      `<button style=\"margin-left: 10px\" onclick=\"deleteToDo(${id})\">Delete</button> ` +
      `<button style=\"margin-left: 10px\" onclick=\"saveEdit(${id})\">Save</button>`;
    const inp = document.getElementById(`input-${id}`);
    if (inp) inp.select();
  }

  function saveEdit(id) {
    const inp = document.getElementById(`input-${id}`);
    if (!inp) return;
    const todos = getTodos();
    const idx = todos.findIndex(t => t.id === id);
    if (idx === -1) return;
    todos[idx].text = inp.value.trim();
    setTodos(todos);
    renderTodos();
  }

  // Bootstrap from storage on load
  document.addEventListener("DOMContentLoaded", () => {
    renderTodos();
    inputEl?.focus();
  });
</script>
</html>
